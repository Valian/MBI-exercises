
R version 3.6.2 (2019-12-12) -- "Dark and Stormy Night"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(data.table)
> library(parallel)
> library(RCurl)
Loading required package: bitops
> library(gdata)
gdata: read.xls support for 'XLS' (Excel 97-2004) files ENABLED.

gdata: Unable to load perl libaries needed by read.xls()
gdata: to support 'XLSX' (Excel 2007+) files.

gdata: Run the function 'installXLSXsupport()'
gdata: to automatically download and install the perl
gdata: libaries needed to support Excel XLS and XLSX formats.

Attaching package: ‘gdata’

The following objects are masked from ‘package:data.table’:

    first, last

The following object is masked from ‘package:stats’:

    nobs

The following object is masked from ‘package:utils’:

    object.size

The following object is masked from ‘package:base’:

    startsWith

> library(Hmisc)
Loading required package: lattice
Loading required package: survival
Loading required package: Formula
Loading required package: ggplot2

Attaching package: ‘Hmisc’

The following objects are masked from ‘package:base’:

    format.pval, units

> library(matrixStats)
> library(DNAcopy)
> library(GenomicRanges)
Loading required package: stats4
Loading required package: BiocGenerics

Attaching package: ‘BiocGenerics’

The following object is masked from ‘package:gdata’:

    combine

The following objects are masked from ‘package:parallel’:

    clusterApply, clusterApplyLB, clusterCall, clusterEvalQ,
    clusterExport, clusterMap, parApply, parCapply, parLapply,
    parLapplyLB, parRapply, parSapply, parSapplyLB

The following objects are masked from ‘package:stats’:

    IQR, mad, sd, var, xtabs

The following objects are masked from ‘package:base’:

    anyDuplicated, append, as.data.frame, basename, cbind, colnames,
    dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,
    grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,
    order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,
    rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,
    union, unique, unsplit, which, which.max, which.min

Loading required package: S4Vectors

Attaching package: ‘S4Vectors’

The following objects are masked from ‘package:gdata’:

    first, first<-

The following objects are masked from ‘package:data.table’:

    first, second

The following object is masked from ‘package:base’:

    expand.grid

Loading required package: IRanges

Attaching package: ‘IRanges’

The following object is masked from ‘package:gdata’:

    trim

The following object is masked from ‘package:data.table’:

    shift

Loading required package: GenomeInfoDb
> library(Rsubread)
> library(WES.1KG.WUGSC)
> library(CODEX)
Loading required package: Rsamtools
Loading required package: Biostrings
Loading required package: XVector

Attaching package: ‘Biostrings’

The following objects are masked from ‘package:Hmisc’:

    mask, translate

The following object is masked from ‘package:base’:

    strsplit

Loading required package: BSgenome.Hsapiens.UCSC.hg19
Loading required package: BSgenome
Loading required package: rtracklayer

Attaching package: ‘CODEX’

The following object is masked from ‘package:BiocGenerics’:

    normalize

The following object is masked from ‘package:DNAcopy’:

    segment

> workDir="./"
> 
> #set number of available cores
> cores <- 4
> 
> #------------------------Zde􏰁niuj nazw¦ projektu oraz utwórz katalog wyj±ciowy:
> projectname <- "TGP99"
> outputDir <- paste0(workDir,"codex_output/")
> dir.create(outputDir)
> 
> 
> 
> #--------------------------------Zaaaduj wst¦pnie przeliczone dane o ga¦boko±ci pokrycia
> # dla 99 próbek z 1000 Genomes i przygotuj dane dla chromosomu 20:
> cfiles <- dir("/data/coverage/", "*bam.coverage*")
> cdf <- rbindlist(mclapply(cfiles, function(f){
+   print(f);
+   df <- fread(paste0("/data/coverage/",f));
+   df$SampleName <- strsplit(f, "\\.")[[1]][1];df
+ },mc.cores=cores))
[1] "NA06985.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA07051.mapped.ILLUMINA.bwa.CEU.exome.20120522.bam.coverage_chr20.txt"
[1] "NA11829.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA11881.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA11992.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA06986.mapped.ILLUMINA.bwa.CEU.exome.20121211.bam.coverage_chr20.txt"
[1] "NA12005.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA12144.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA12489.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA12815.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18486.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1] "NA07347.mapped.ILLUMINA.bwa.CEU.exome.20121211.bam.coverage_chr20.txt"
[1] "NA18501.mapped.ILLUMINA.bwa.YRI.exome.20121211.bam.coverage_chr20.txt"
[1] "NA11830.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18507.mapped.ILLUMINA.bwa.YRI.exome.20130415.bam.coverage_chr20.txt"
[1] "NA11918.mapped.ILLUMINA.bwa.CEU.exome.20121211.bam.coverage_chr20.txt"
[1] "NA18519.mapped.ILLUMINA.bwa.YRI.exome.20121211.bam.coverage_chr20.txt"
[1] "NA11994.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA07000.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18634.mapped.ILLUMINA.bwa.CHB.exome.20120522.bam.coverage_chr20.txt"
[1] "NA12043.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18642.mapped.ILLUMINA.bwa.CHB.exome.20130415.bam.coverage_chr20.txt"
[1] "NA12154.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18745.mapped.ILLUMINA.bwa.CHB.exome.20130415.bam.coverage_chr20.txt"
[1] "NA12762.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1][1] "NA12872.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
 "NA18757.mapped.ILLUMINA.bwa.CHB.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18868.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18489.mapped.ILLUMINA.bwa.YRI.exome.20121211.bam.coverage_chr20.txt"
[1] "NA18874.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18502.mapped.ILLUMINA.bwa.YRI.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18956.mapped.ILLUMINA.bwa.JPT.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18508.mapped.ILLUMINA.bwa.YRI.exome.20130415.bam.coverage_chr20.txt"
[1] "NA07048.mapped.ILLUMINA.bwa.CEU.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18520.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18964.mapped.ILLUMINA.bwa.JPT.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18639.mapped.ILLUMINA.bwa.CHB.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18997.mapped.ILLUMINA.bwa.JPT.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18643.mapped.ILLUMINA.bwa.CHB.exome.20130415.bam.coverage_chr20.txt"
[1] "NA19003.mapped.ILLUMINA.bwa.JPT.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18747.mapped.ILLUMINA.bwa.CHB.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18853.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1][1] "NA10851.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA19092.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
 "NA18870.mapped.ILLUMINA.bwa.YRI.exome.20121211.bam.coverage_chr20.txt"
[1] "NA11832.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1][1][1] "NA11920.mapped.ILLUMINA.bwa.CEU.exome.20121211.bam.coverage_chr20.txt"
 "NA18910.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1][1] "NA12003.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt" "NA19116.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"

 "NA07357.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18959.mapped.ILLUMINA.bwa.JPT.exome.20121211.bam.coverage_chr20.txt"
[1] "NA12045.mapped.ILLUMINA.bwa.CEU.exome.20121211.bam.coverage_chr20.txt"
[1] "NA18965.mapped.ILLUMINA.bwa.JPT.exome.20130415.bam.coverage_chr20.txt"
[1] "NA12234.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1][1] "NA12813.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
 "NA11831.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18998.mapped.ILLUMINA.bwa.JPT.exome.20130415.bam.coverage_chr20.txt"
[1] "NA12878.mapped.ILLUMINA.bwa.CEU.exome.20121211.bam.coverage_chr20.txt"
[1] "NA18499.mapped.ILLUMINA.bwa.YRI.exome.20121211.bam.coverage_chr20.txt"
[1] "NA11919.mapped.ILLUMINA.bwa.CEU.exome.20121211.bam.coverage_chr20.txt"
[1] "NA19005.mapped.ILLUMINA.bwa.JPT.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18505.mapped.ILLUMINA.bwa.YRI.exome.20130415.bam.coverage_chr20.txt"
[1] "NA19093.mapped.ILLUMINA.bwa.YRI.exome.20121211.bam.coverage_chr20.txt"
[1][1] "NA18516.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
 "NA11995.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
[1] "NA19130.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18631.mapped.ILLUMINA.bwa.CHB.exome.20120522.bam.coverage_chr20.txt"
[1][1] "NA12044.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
 "NA18641.mapped.ILLUMINA.bwa.CHB.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18740.mapped.ILLUMINA.bwa.CHB.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18749.mapped.ILLUMINA.bwa.CHB.exome.20130415.bam.coverage_chr20.txt"[1] "NA12156.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"

[1][1] "NA12812.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
 "NA18867.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18873.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1][1] "NA12873.mapped.ILLUMINA.bwa.CEU.exome.20130415.bam.coverage_chr20.txt"
 "NA18953.mapped.ILLUMINA.bwa.JPT.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18961.mapped.ILLUMINA.bwa.JPT.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18498.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18980.mapped.ILLUMINA.bwa.JPT.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18504.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1][1] "NA19000.mapped.ILLUMINA.bwa.JPT.exome.20120522.bam.coverage_chr20.txt"
 "NA18510.mapped.ILLUMINA.bwa.YRI.exome.20121211.bam.coverage_chr20.txt"
[1][1] "NA19012.mapped.ILLUMINA.bwa.JPT.exome.20120522.bam.coverage_chr20.txt"
 "NA18522.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1] "NA19102.mapped.ILLUMINA.bwa.YRI.exome.20121211.bam.coverage_chr20.txt"
[1] "NA18640.mapped.ILLUMINA.bwa.CHB.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18645.mapped.ILLUMINA.bwa.CHB.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18748.mapped.ILLUMINA.bwa.CHB.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18856.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18871.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18912.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18960.mapped.ILLUMINA.bwa.JPT.exome.20120522.bam.coverage_chr20.txt"
[1] "NA18978.mapped.ILLUMINA.bwa.JPT.exome.20130415.bam.coverage_chr20.txt"
[1] "NA18999.mapped.ILLUMINA.bwa.JPT.exome.20120522.bam.coverage_chr20.txt"
[1] "NA19007.mapped.ILLUMINA.bwa.JPT.exome.20120522.bam.coverage_chr20.txt"
[1] "NA19099.mapped.ILLUMINA.bwa.YRI.exome.20130422.bam.coverage_chr20.txt"
[1] "NA19172.mapped.ILLUMINA.bwa.YRI.exome.20120522.bam.coverage_chr20.txt"
> colnames(cdf) <- c("Chr", "Start", "Stop", "ReadCount", "SampleName")
> cdf <- cdf[order(cdf$SampleName, cdf$Chr, cdf$Start, cdf$Stop),]
> dim(cdf)
[1] 465498      5
> #[1] 465498        5
> head(cdf)
   Chr  Start   Stop ReadCount SampleName
1:  20  68319  68439       103    NA06985
2:  20  76611  77091       129    NA06985
3:  20 123208 123358        69    NA06985
4:  20 125995 126389       105    NA06985
5:  20 138119 138269        37    NA06985
6:  20 139359 139719       156    NA06985
> #   Chr  Start   Stop ReadCount SampleName
> #1:  20  68319  68439
> #2:  20  76611  77091
> #3:  20 123208 123358
> #4:  20 125995 126389
> #5:  20 138119 138269
> #6:  20 139359 139719
> bedFile <- paste0("/data/bed/20130108.exome.targets.bed")
> sampname <- unique(cdf$SampleName)
> chr <- "20"
> targetsChr <-  cdf[which(cdf$Chr==chr & cdf$SampleName == cdf$SampleName[1]),
+                    c("Chr", "Start",  "Stop")]
> selChr <- cdf[which(cdf$Chr==chr),]
> Y <- t(do.call(rbind,lapply(sampname,
+                             function(s){selChr$ReadCount [which(selChr$SampleName == s)]})))
> colnames(Y) <- sampname
> rownames(Y) <- 1:nrow(Y)
> dim(Y)
[1] 4702   99
> #103    NA06985
> #129    NA06985
> #69    NA06985
> #105    NA06985
> #37    NA06985
> #156    NA06985
> #4
> #[1] 4702   99
> dim(targetsChr)
[1] 4702    3
> #[1] 4702    3
> ref <- IRanges(start = targetsChr$Start, end = targetsChr$Stop)
> gc <- getgc(chr, ref)
> mapp <- getmapp(chr, ref)
> 
> 
> 
> 
> #-------------------------------------------------Przeprowad1 kontrol¦ jako±ci:
> mapp_thresh <- 0.9 # remove exons with mapability < 0.9
> cov_thresh_from <- 20 # remove exons covered by less than 20 reads
> cov_thresh_to <- 4000 #  remove exons covered by more than 4000 reads
> length_thresh_from <- 20 # remove exons of size < 20
> length_thresh_to <- 2000 # remove exons of size > 2000
> gc_thresh_from <- 25 # remove exons with GC < 20
> gc_thresh_to <- 75 # or GC > 80
> qcObj <- qc(Y, sampname, chr, ref, mapp, gc,
+             cov_thresh = c(cov_thresh_from, cov_thresh_to),
+             length_thresh = c(length_thresh_from, length_thresh_to),
+             mapp_thresh = mapp_thresh,
+             gc_thresh = c(gc_thresh_from, gc_thresh_to))
Excluded 279 exons due to extreme coverage.
Excluded 18 exons due to extreme exonic length.
Excluded 22 exons due to extreme mappability.
Excluded 88 exons due to extreme GC content.
After taking union, excluded 325 out of 4702 exons in QC.
> Y_qc <- qcObj$Y_qc; sampname_qc <- qcObj$sampname_qc; gc_qc <- qcObj$gc_qc
> mapp_qc <- qcObj$mapp_qc; ref_qc <- qcObj$ref_qc; qcmat <- qcObj$qcmat
> #Ile eksonów (regionów) zostaao usuni¦tych w wyniku kontroli jako±ci?
> #  Ile eksonów (regionów) b¦dzie usuni¦tych je»eli zmienimy progi odci¦cia za- warto±ci GC (gc_thresh_from, gc_thresh_to)? Podaj wynik dla wybranych przez Ciebie progów.
> 
> 
> 
> 
> #-----------------------------------------------Przeprowad1 normalizacj¦ ga¦boko±ci pokrycia oraz segmentacj¦:
> normObj <- normalize(Y_qc, gc_qc, K = 1:9)
k = 1
Iteration 1	beta diff =0.46	f(GC) diff =5.7e-08
			hhat diff =4.39e-05
Iteration 2	beta diff =0.0423	f(GC) diff =2.19e-10
			hhat diff =2.75e-05
Iteration 3	beta diff =0.000944	f(GC) diff =1.03e-11
			hhat diff =2.22e-05
Iteration 4	beta diff =0.000123	f(GC) diff =3.05e-12
			hhat diff =2.01e-05
Iteration 5	beta diff =7.28e-05	f(GC) diff =2.49e-12
			hhat diff =1.87e-05
Stop at Iteration 5.
AIC1 = 712791048.982
BIC1 = 712741905.91
RSS1 = 467.702

k = 2
Iteration 1	beta diff =0.46	f(GC) diff =5.7e-08
			hhat diff =0.000749
			hhat diff =0.000139
			hhat diff =2.82e-05
Iteration 2	beta diff =0.041	f(GC) diff =2.42e-10
			hhat diff =0.000324
			hhat diff =2.89e-05
Iteration 3	beta diff =0.00078	f(GC) diff =1.21e-11
			hhat diff =0.00028
			hhat diff =2.21e-05
Iteration 4	beta diff =0.000122	f(GC) diff =3.85e-12
			hhat diff =0.000257
			hhat diff =1.89e-05
Iteration 5	beta diff =6.83e-05	f(GC) diff =2.93e-12
			hhat diff =0.000241
			hhat diff =1.71e-05
Stop at Iteration 5.
AIC2 = 712939762.461
BIC2 = 712841476.316
RSS2 = 378.05

k = 3
Iteration 1	beta diff =0.46	f(GC) diff =5.7e-08
			hhat diff =0.0135
			hhat diff =3.09e-05
Iteration 2	beta diff =0.0401	f(GC) diff =2.43e-10
			hhat diff =0.0135
			hhat diff =0.0269
			hhat diff =2.52e-05
Iteration 3	beta diff =0.000804	f(GC) diff =1.37e-11
			hhat diff =0.0135
			hhat diff =4.49e-05
Iteration 4	beta diff =0.000121	f(GC) diff =4.16e-12
			hhat diff =0.0259
			hhat diff =4.41e-05
Iteration 5	beta diff =5.6e-05	f(GC) diff =3.02e-12
			hhat diff =0.026
			hhat diff =5.62e-05
Stop at Iteration 5.
AIC3 = 713008072.13
BIC3 = 712860642.913
RSS3 = 341.76

k = 4
Iteration 1	beta diff =0.46	f(GC) diff =5.7e-08
			hhat diff =0.0194
			hhat diff =0.0202
			hhat diff =1.82e-05
Iteration 2	beta diff =0.0389	f(GC) diff =2.4e-10
			hhat diff =0.0297
			hhat diff =0.0202
			hhat diff =0.0202
			hhat diff =1.46e-06
Iteration 3	beta diff =0.000816	f(GC) diff =1.28e-11
			hhat diff =0.0298
			hhat diff =4.57e-05
Iteration 4	beta diff =0.000129	f(GC) diff =3.96e-12
			hhat diff =0.0102
			hhat diff =0.0202
			hhat diff =1.07e-05
Iteration 5	beta diff =5.53e-05	f(GC) diff =2.45e-12
			hhat diff =0.0102
			hhat diff =0.0202
			hhat diff =1.39e-05
Stop at Iteration 5.
AIC4 = 713084524.472
BIC4 = 712887952.183
RSS4 = 283.51

k = 5
Iteration 1	beta diff =0.46	f(GC) diff =5.7e-08
			hhat diff =0.0169
			hhat diff =0.0162
			hhat diff =0.0162
			hhat diff =4.62e-06
Iteration 2	beta diff =0.0376	f(GC) diff =2.45e-10
			hhat diff =0.0162
			hhat diff =0.00811
			hhat diff =0.0162
			hhat diff =0.0162
			hhat diff =4.09e-07
Iteration 3	beta diff =0.000843	f(GC) diff =1.31e-11
			hhat diff =0.00837
			hhat diff =5.26e-05
Iteration 4	beta diff =0.000129	f(GC) diff =4.15e-12
			hhat diff =0.00837
			hhat diff =0.0162
			hhat diff =1.11e-05
Iteration 5	beta diff =5.1e-05	f(GC) diff =2.48e-12
			hhat diff =0.0163
			hhat diff =0.0323
			hhat diff =1.19e-05
Stop at Iteration 5.
AIC5 = 713109988.346
BIC5 = 712864272.984
RSS5 = 263.103

k = 6
Iteration 1	beta diff =0.46	f(GC) diff =5.7e-08
			hhat diff =0.00783
			hhat diff =0.0135
			hhat diff =2.61e-05
Iteration 2	beta diff =0.0372	f(GC) diff =2.52e-10
			hhat diff =0.0134
			hhat diff =3.68e-05
Iteration 3	beta diff =0.000917	f(GC) diff =1.63e-11
			hhat diff =0.000225
			hhat diff =3.82e-05
Iteration 4	beta diff =0.000134	f(GC) diff =3.95e-12
			hhat diff =0.0201
			hhat diff =3.79e-05
Iteration 5	beta diff =4.84e-05	f(GC) diff =2.4e-12
			hhat diff =0.0201
			hhat diff =3.39e-05
Stop at Iteration 5.
AIC6 = 713126544.832
BIC6 = 712831686.398
RSS6 = 254.174

k = 7
Iteration 1	beta diff =0.46	f(GC) diff =5.7e-08
			hhat diff =0.0123
			hhat diff =0.0116
			hhat diff =6.23e-05
Iteration 2	beta diff =0.0376	f(GC) diff =2.79e-10
			hhat diff =0.0117
			hhat diff =6.65e-05
Iteration 3	beta diff =0.000869	f(GC) diff =1.7e-11
			hhat diff =0.0118
			hhat diff =0.0116
			hhat diff =2.03e-05
Iteration 4	beta diff =0.000145	f(GC) diff =6.46e-12
			hhat diff =0.0117
			hhat diff =0.00581
			hhat diff =6.04e-06
Iteration 5	beta diff =5.31e-05	f(GC) diff =3.46e-12
			hhat diff =0.0173
			hhat diff =2.15e-05
Stop at Iteration 5.
AIC7 = 713143181.969
BIC7 = 712799180.462
RSS7 = 237.139

k = 8
Iteration 1	beta diff =0.46	f(GC) diff =5.7e-08
			hhat diff =0.0159
			hhat diff =0.000113
			hhat diff =0.01
			hhat diff =0.000214
			hhat diff =0.000115
			hhat diff =4.99e-05
Stop at Iteration 1.
AIC8 = 711312857.944
BIC8 = 710919713.365
RSS8 = 960.137

k = 9
Iteration 1	beta diff =0.46	f(GC) diff =5.7e-08
			hhat diff =0.0144
			hhat diff =0.00451
			hhat diff =0.00463
			hhat diff =0.0178
			hhat diff =0.00461
			hhat diff =0.00459
			hhat diff =0.018
			hhat diff =2.43e-05
Stop at Iteration 1.
AIC9 = 711322632.448
BIC9 = 710880344.797
RSS9 = 947.625

> Yhat <- normObj$Yhat; AIC <- normObj$AIC; BIC <- normObj$BIC
> RSS <- normObj$RSS; K <- normObj$K
> optK <- choiceofK(AIC, BIC, RSS, K,
+                   filename = paste(projectname, "_", chr, "_choiceofK", ".pdf", sep = ""))
> finalcall <- CODEX::segment(Y_qc, Yhat, optK = optK,
+                             K = K, sampname_qc,
+                             ref_qc, chr, lmax = 200,
+                             mode = "integer")
Segmenting sample 1: NA06985.
Segmenting sample 2: NA06986.
Segmenting sample 3: NA07000.
Segmenting sample 4: NA07048.
Segmenting sample 5: NA07051.
Segmenting sample 6: NA07347.
Segmenting sample 7: NA07357.
Segmenting sample 8: NA10851.
Segmenting sample 9: NA11829.
Segmenting sample 10: NA11830.
Segmenting sample 11: NA11831.
Segmenting sample 12: NA11832.
Segmenting sample 13: NA11881.
Segmenting sample 14: NA11918.
Segmenting sample 15: NA11919.
Segmenting sample 16: NA11920.
Segmenting sample 17: NA11992.
Segmenting sample 18: NA11994.
Segmenting sample 19: NA11995.
Segmenting sample 20: NA12003.
Segmenting sample 21: NA12005.
Segmenting sample 22: NA12043.
Segmenting sample 23: NA12044.
Segmenting sample 24: NA12045.
Segmenting sample 25: NA12144.
Segmenting sample 26: NA12154.
Segmenting sample 27: NA12156.
Segmenting sample 28: NA12234.
Segmenting sample 29: NA12489.
Segmenting sample 30: NA12762.
Segmenting sample 31: NA12812.
Segmenting sample 32: NA12813.
Segmenting sample 33: NA12815.
Segmenting sample 34: NA12872.
Segmenting sample 35: NA12873.
Segmenting sample 36: NA12878.
Segmenting sample 37: NA18486.
Segmenting sample 38: NA18489.
Segmenting sample 39: NA18498.
Segmenting sample 40: NA18499.
Segmenting sample 41: NA18501.
Segmenting sample 42: NA18502.
Segmenting sample 43: NA18504.
Segmenting sample 44: NA18505.
Segmenting sample 45: NA18507.
Segmenting sample 46: NA18508.
Segmenting sample 47: NA18510.
Segmenting sample 48: NA18516.
Segmenting sample 49: NA18519.
Segmenting sample 50: NA18520.
Segmenting sample 51: NA18522.
Segmenting sample 52: NA18631.
Segmenting sample 53: NA18634.
Segmenting sample 54: NA18639.
Segmenting sample 55: NA18640.
Segmenting sample 56: NA18641.
Segmenting sample 57: NA18642.
Segmenting sample 58: NA18643.
Segmenting sample 59: NA18645.
Segmenting sample 60: NA18740.
Segmenting sample 61: NA18745.
Segmenting sample 62: NA18747.
Segmenting sample 63: NA18748.
Segmenting sample 64: NA18749.
Segmenting sample 65: NA18757.
Segmenting sample 66: NA18853.
Segmenting sample 67: NA18856.
Segmenting sample 68: NA18867.
Segmenting sample 69: NA18868.
Segmenting sample 70: NA18870.
Segmenting sample 71: NA18871.
Segmenting sample 72: NA18873.
Segmenting sample 73: NA18874.
Segmenting sample 74: NA18910.
Segmenting sample 75: NA18912.
Segmenting sample 76: NA18953.
Segmenting sample 77: NA18956.
Segmenting sample 78: NA18959.
Segmenting sample 79: NA18960.
Segmenting sample 80: NA18961.
Segmenting sample 81: NA18964.
Segmenting sample 82: NA18965.
Segmenting sample 83: NA18978.
Segmenting sample 84: NA18980.
Segmenting sample 85: NA18997.
Segmenting sample 86: NA18998.
Segmenting sample 87: NA18999.
Segmenting sample 88: NA19000.
Segmenting sample 89: NA19003.
Segmenting sample 90: NA19005.
Segmenting sample 91: NA19007.
Segmenting sample 92: NA19012.
Segmenting sample 93: NA19092.
Segmenting sample 94: NA19093.
Segmenting sample 95: NA19099.
Segmenting sample 96: NA19102.
Segmenting sample 97: NA19116.
Segmenting sample 98: NA19130.
Segmenting sample 99: NA19172.
> finalcall <- data.frame(finalcall, stringsAsFactors=F)
> finalcall$targetCount <- as.numeric(finalcall$ed_exon) - as.numeric(finalcall$st_exon)
> 
> 
> plotCall <- function(calls,i , Y_qc, Yhat_opt){
+   startIdx <- as.numeric(calls$st_exon[i])
+   stopIdx <- as.numeric(calls$ed_exon[i])
+   sampleName <- calls$sample_name[i]
+   wd <- 20
+   startPos <- max(1,(startIdx-wd))
+   stopPos <- min((stopIdx+wd), nrow(Y_qc))
+   selQC <- Y_qc[startPos:stopPos,]
+   selQC[selQC ==0] <- 0.00001
+   selYhat <- Yhat_opt[startPos:stopPos,]
+   matplot(matrix(rep(startPos:stopPos, ncol(selQC)),
+                  ncol=ncol(selQC)), log(selQC/selYhat,2),
+           type="l",lty=1, col="dimgrey",  lwd=1,
+           xlab="exon nr", ylab="logratio(Y/Yhat)")
+   lines(startPos:stopPos,log( selQC[,sampleName]/ selYhat[,sampleName],2), lwd=3, col="red")
+ }
> cnvId <- 1    # indeks zmiany dla której zostanie sporz¡dzony wykres
> plotCall(finalcall, cnvId, Y_qc, Yhat[[optK]])
> 
